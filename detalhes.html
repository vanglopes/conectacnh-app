<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Instrutor - ConectaCNH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style> .font-serif-custom { font-family: 'Georgia', serif; } </style>
</head>
<body class="bg-slate-50 text-slate-900 pb-24">

    <div class="relative h-48 bg-slate-900 overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-t from-slate-900 to-transparent z-10"></div>
        <img src="https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?q=80&w=1000&auto=format&fit=crop" class="w-full h-full object-cover opacity-50">
        
        <a href="home.html" class="absolute top-6 left-4 z-20 w-10 h-10 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center text-white hover:bg-white/20 transition-all">
            <i class="fa-solid fa-arrow-left"></i>
        </a>
    </div>

    <div class="px-6 relative z-20 -mt-12">
        <div class="flex items-end justify-between">
            <div class="relative">
                <img id="img-perfil" src="" class="w-24 h-24 rounded-full border-4 border-slate-50 shadow-lg object-cover bg-slate-200">
                <div class="absolute bottom-1 right-1 w-6 h-6 bg-green-500 rounded-full border-2 border-slate-50 flex items-center justify-center text-white text-[10px]">
                    <i class="fa-solid fa-check"></i>
                </div>
            </div>
            <div class="mb-2 text-right">
                <div class="flex items-center gap-1 bg-white px-3 py-1 rounded-full shadow-sm text-xs font-bold text-slate-700">
                    <i class="fa-solid fa-star text-orange-400"></i>
                    <span id="txt-nota">5.0</span>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <h1 id="txt-nome" class="text-2xl font-bold text-slate-900">Carregando...</h1>
            <div class="flex items-center gap-3 mt-1 text-sm text-slate-500">
                <span id="txt-categoria" class="bg-cyan-100 text-cyan-700 px-2 py-0.5 rounded text-[10px] font-bold uppercase">...</span>
                <span class="flex items-center gap-1"><i class="fa-solid fa-location-dot text-cyan-500"></i> <span id="txt-cidade">São Paulo</span></span>
            </div>
        </div>
    </div>

    <div class="px-6 mt-8 border-b border-slate-200">
        <div class="flex gap-8">
            <button onclick="mudarAba('servicos')" id="tab-servicos" class="pb-3 border-b-2 border-cyan-500 text-cyan-600 font-bold text-sm transition-colors">Serviços</button>
            <button onclick="mudarAba('sobre')" id="tab-sobre" class="pb-3 border-b-2 border-transparent text-slate-400 font-bold text-sm hover:text-slate-600 transition-colors">Sobre</button>
            <button onclick="mudarAba('avaliacoes')" id="tab-avaliacoes" class="pb-3 border-b-2 border-transparent text-slate-400 font-bold text-sm hover:text-slate-600 transition-colors">Avaliações</button>
        </div>
    </div>

    <div id="content-servicos" class="p-6 space-y-4 animate-[fadeIn_0.3s_ease-out]">
        <h3 class="font-bold text-slate-800">Escolha seu pacote</h3>
        
        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center">
            <div>
                <h4 class="font-bold text-slate-800 text-sm">Aula Prática Avulsa</h4>
                <p class="text-xs text-slate-400 mt-1">50 minutos • Carro manual</p>
            </div>
            <div class="text-right">
                <span id="txt-preco" class="block font-bold text-slate-800 text-lg">R$ --</span>
                <button onclick="irParaAgendamento()" class="bg-cyan-100 text-cyan-700 px-4 py-1.5 rounded-lg text-xs font-bold mt-1 hover:bg-cyan-200 transition-colors">
                    Selecionar
                </button>
            </div>
        </div>
        
        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center opacity-60">
            <div>
                <h4 class="font-bold text-slate-800 text-sm">Pacote 10 Aulas</h4>
                <p class="text-xs text-slate-400 mt-1">Desconto de 5%</p>
            </div>
            <div class="text-right">
                <span class="block font-bold text-slate-800 text-lg">R$ --</span>
                <span class="text-[10px] text-slate-400">Em breve</span>
            </div>
        </div>
    </div>

    <div id="content-sobre" class="p-6 space-y-6 hidden animate-[fadeIn_0.3s_ease-out]">
        
        <div>
            <h3 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                <i class="fa-solid fa-map-pin text-cyan-500"></i> Ponto de Encontro
            </h3>
            <p id="txt-endereco-completo" class="text-sm text-slate-500 leading-relaxed bg-slate-50 p-3 rounded-lg border border-slate-100">
                Carregando endereço...
            </p>
        </div>

        <div>
            <h3 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                <i class="fa-solid fa-id-card text-cyan-500"></i> Habilitação
            </h3>
            <p id="txt-bio-categorias" class="text-sm text-slate-500">
                Instrutor credenciado para as categorias: ...
            </p>
        </div>

        <div>
            <h3 class="font-bold text-slate-800 mb-2">Contato Direto</h3>
            <div id="box-contato">
                <p class="text-xs text-slate-400">Este instrutor não cadastrou telefone.</p>
            </div>
        </div>
    </div>

    <div id="content-avaliacoes" class="p-6 hidden animate-[fadeIn_0.3s_ease-out]">
        <div class="text-center py-8">
            <div class="text-4xl font-bold text-slate-800 mb-1" id="txt-nota-grande">5.0</div>
            <div class="text-orange-400 text-sm mb-2">
                <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
            </div>
            <p class="text-xs text-slate-400" id="txt-total-avaliacoes">Baseado em 0 aulas</p>
        </div>
        </div>

    <div class="fixed bottom-0 w-full bg-white border-t border-slate-100 p-4 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-50 max-w-md left-1/2 -translate-x-1/2 flex justify-between items-center">
        <div>
            <p class="text-[10px] text-slate-400 uppercase font-bold">Total a pagar</p>
            <p id="txt-total-bar" class="text-xl font-bold text-slate-900">R$ --</p>
        </div>
        <button onclick="irParaAgendamento()" class="bg-cyan-500 hover:bg-cyan-400 text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-cyan-500/20 transition-all">
            Reservar
        </button>
    </div>

    <script>
        const SUPABASE_URL = 'https://gfazevzzvgafmlnmkgjo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdmYXpldnp6dmdhZm1sbm1rZ2pvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NDE3MjMsImV4cCI6MjA4MTUxNzcyM30.00SUzPZP0-YCxwaynA0Eu8lBM2O7E4Sp52lwLVACRSo';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let instrutorAtual = null;

        window.onload = async function() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            if (!id) { alert("Instrutor não especificado."); window.location.href = 'home.html'; return; }

            // BUSCA PODEROSA: Instrutor + Dados do Usuário (Telefone)
            const { data: instrutor, error } = await supabaseClient
                .from('instrutores')
                .select('*, usuarios(telefone, email)') 
                .eq('id', id)
                .single();

            if (error || !instrutor) { alert("Instrutor não encontrado."); return; }

            instrutorAtual = instrutor;
            renderizarDados(instrutor);
        };

        function renderizarDados(i) {
            // Cabeçalho
            document.getElementById('txt-nome').innerText = i.nome;
            document.getElementById('img-perfil').src = i.foto_url;
            document.getElementById('txt-categoria').innerText = i.categoria || 'Autônomo';
            
            // Nota e Preço
            const nota = i.nota ? i.nota.toFixed(1) : "5.0";
            document.getElementById('txt-nota').innerText = nota;
            document.getElementById('txt-nota-grande').innerText = nota;
            document.getElementById('txt-total-avaliacoes').innerText = `Baseado em ${i.avaliacoes_count || 0} aulas`;
            
            const preco = `R$ ${i.preco_aula.toFixed(2)}`;
            document.getElementById('txt-preco').innerText = preco;
            document.getElementById('txt-total-bar').innerText = preco;

            // --- ABA SOBRE (Novidade) ---
            
            // 1. Endereço
            document.getElementById('txt-endereco-completo').innerText = i.endereco || "Endereço não informado pelo instrutor.";
            
            // 2. Categorias
            let cats = i.categorias ? i.categorias.join(', ') : i.categoria;
            document.getElementById('txt-bio-categorias').innerText = `Instrutor habilitado e credenciado para ensinar nas categorias: ${cats}.`;

            // 3. WhatsApp (Puxado da tabela usuarios)
            if (i.usuarios && i.usuarios.telefone) {
                const numLimpo = i.usuarios.telefone.replace(/\D/g, '');
                document.getElementById('box-contato').innerHTML = `
                    <a href="https://wa.me/55${numLimpo}?text=Olá, vi seu perfil no ConectaCNH e gostaria de tirar dúvidas." target="_blank" 
                       class="flex items-center justify-center gap-2 w-full bg-green-500 text-white font-bold py-3 rounded-xl hover:bg-green-400 transition-colors shadow-lg shadow-green-500/20">
                        <i class="fa-brands fa-whatsapp text-xl"></i> Conversar no WhatsApp
                    </a>
                    <p class="text-[10px] text-center text-slate-400 mt-2">Dica: Tire suas dúvidas antes de reservar.</p>
                `;
            }
        }

        // --- SISTEMA DE ABAS ---
        function mudarAba(aba) {
            // Reseta cores dos botões
            ['servicos', 'sobre', 'avaliacoes'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                const content = document.getElementById(`content-${t}`);
                
                if (t === aba) {
                    btn.className = "pb-3 border-b-2 border-cyan-500 text-cyan-600 font-bold text-sm transition-colors";
                    content.classList.remove('hidden');
                } else {
                    btn.className = "pb-3 border-b-2 border-transparent text-slate-400 font-bold text-sm hover:text-slate-600 transition-colors";
                    content.classList.add('hidden');
                }
            });
        }

        function irParaAgendamento() {
            window.location.href = `agendamento.html?id=${instrutorAtual.id}`;
        }
    </script>
</body>
</html>